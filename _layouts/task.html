---
layout: default
---
{{ content }}
{% include task_nav.html %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.5/showdown.min.js"></script>
<div ng-app="myApp" ng-controller="task">
    <div ng-if="epic != null" class="row">
        <div class="col-12">
            <span ng-bind="epic.fields.project.name"></span> - <span ng-bind="epic.fields.issuetype.name"></span>
            <a ng-href="/task?id={%raw%}{{epic.id}}{%endraw%}" ng-bind="epic.fields.summary" ng-cloak class="mr-1"></a>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <span ng-bind="task.fields.project.name"></span>
            <span ng-bind="task.fields.issuetype.name"></span>
            <h3 ng-bind="task.fields.summary" class="mb-2"></h3>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <img ng-if="task.fields.status.name == 'In Progress' " ng-src='https://img.shields.io/badge/Status-In--Progress-blue.svg' class='align-top' style="align-self: center" ng-cloak></img>
            <img ng-if="task.fields.status.name == 'Closed' " ng-src='https://img.shields.io/badge/Status-Closed-brightgreen.svg' class='align-top' style="align-self: center" ng-cloak></img>
            <img ng-if="task.fields.status.name == 'Open' " ng-src='https://img.shields.io/badge/Status-To--Do-red.svg' class='align-top' style="align-self: center" ng-cloak></img>
            <a ng-if="task" ng-href="https://timetopretend.atlassian.net/browse/{%raw%}{{task.key}}{%endraw%}" target='_blank' style='text-align:right' class='pl-2 pr-2' ng-cloak><i class='fas fa-database' ng-cloak></i></a>
            <span ng-bind="task.fields.priority.name" ng-cloak></span>
            <hr ng-if="task.fields.description != null" class="mt-2 mb-0"/>
        </div>
    </div>
    <div ng-if="task.fields.description != null" class="row">
        <div ng-cloak class="col-12">
            <h4 ng-if="task.fields.description != null" ng-cloak>Description</h4>
            <div ng-if="task.fields.description != null" ng-bind="task.fields.description" ng-cloak></div>
            <div ng-repeat="detail in result.detail" ng-cloak>
                <div ng-repeat="repo in detail.repositories" ng-cloak>
                    <h4 ng-if="repo.commits.length > 0" class="mt-2" ng-cloak>Commits</h4>
                    <hr ng-if="repo.commits.length > 0" ng-cloak/>
                    <div ng-repeat="commit in repo.commits">
                        <a ng-href="{%raw%}{{commit.url}}{%endraw%}" ng-bind="commit.message" target="_blank"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div ng-repeat="project in projects" ng-cloak>
                <h4 ng-bind="project"></h4>
                <hr ng-if="stories.length > 0" ng-cloak/>
                <table class="mb-3">
                    <tr ng-repeat="task in stories" ng-if="task.fields.project.name == project" ng-cloak>
                        <td class="align-top">
                            <i ng-if="task.fields.status.id == 6" class='fas fa-check-circle mr-1' style='color:green;'></i>
                            <i ng-if="task.fields.status.id == 3" class='fas fa-spinner mr-1' style='color:green;'></i>
                            <i ng-if="task.fields.status.id == 1" class='far fa-circle mr-1' style='color:green;'></i>        
                        </td>
                        <td>
                            <a ng-href="/task?id={%raw%}{{task.id}}{%endraw%}" ng-bind="task.fields.summary"></a>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <h4 ng-if="task.fields.attachment.length > 0" ng-cloak>Pictures</h4>
    <hr ng-if="task.fields.attachment.length > 0" ng-cloak/>
    <div class="row ml-0">
        <div ng-repeat="attachment in task.fields.attachment" class="col-md-4 mb-4">
            <img ng-src="{%raw%}{{attachment.thumbnail}}{%endraw%}"></img>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div id="readme"></div>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script>
var app = angular.module('myApp', []);
app.controller('task', function($scope, $http) {
    
    function setStories(tasks) {
        $scope.stories = tasks;
        var projects = $.unique(tasks.map(function (task) {return task.fields.project.name;}));
        projects.reverse();
        $scope.projects = projects;
        $scope.$digest();
    }

    function setRepo(result) {
        $scope.result = result;
        $scope.$digest();
    }

    function setView(task,epic){
        $scope.task = task;
        $scope.epic = epic;
        $scope.$digest();
        getTasksAsync("\"Epic%20Link\"%20%3D%20" + task.id + "&fields=summary,project,status", 0, setStories);
        getRepoData(id, setRepo);
    }
    
    var id = getParameterByName("id");
    getTaskAsync(getParameterByName("id"),setView);
});
</script>